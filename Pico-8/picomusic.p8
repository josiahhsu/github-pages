pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
#include shared/gridhelpers.p8

function _init()
	cls()
	// grid size
	m,n = 16,13
	set_grid(make_grid(),true)
	
	// player position and note
	px,py,pn = 1,1,0
	
	notes ={"b#","b","a#","a",
	        "g#","g","f#","f",
	        "e","d#","d","c#","c"}
	tempo = 5
	
	t = 0
	state = edit_state()
end

function _update()
	controls()
	state.update()
end

function _draw()
	draw_grid()
	state.draw()
end
-->8
function make_cell()
	//makes a cell and determines
	//whether it's marked or not
	local cell = {}
	cell.spr = -1
	return cell
end

function shuffle(t)
	for i = 1, #t do
		local j = rand_int(i)
		t[i],t[j] = t[j],t[i]
	end
end

function make_grid()
	local grid = {}
	for i = 1, m do
		grid[i] = {}
		for j = 1, n do
			grid[i][j] = make_cell()
		end
	end
	return grid
end
-->8
function controls()
	//player controls for movement
	//and revealing cells
	if btnp(‚¨ÖÔ∏è) then
		move_horz(-1)
	elseif btnp(‚û°Ô∏è) then
		move_horz(1)
	elseif btnp(‚¨ÜÔ∏è) then
		move_vert(-1)
	elseif btnp(‚¨áÔ∏è) then
		move_vert(1)
	end

	if btnp(üÖæÔ∏è) then
		state.o()
	elseif btnp(‚ùé) then
		state.x()
	end
end

function move_horz(dx)
	if in_bounds_x(px+dx) then
		px += dx
	end
end

function move_vert(dy)
	if in_bounds_y(py+dy) then
		py += dy
	end
end
-->8
function coords(x,y)
	//translates value to partial
	//position on grid
	return (x-1)*7+2,y*7
end

function draw_grid()
	rectfill(0,0,126,128,1)
	cell_do_all(
	function(x,y)
		//draws cells on grid
		spr(16, coords(x,y))
		spr(get_cell(x,y).spr,coords(x,y))
	end
	)
end

function draw_pointer()
	//draws pointer position
	local x,y = coords(px,py)
	rect(x,y,x+7,y+7,9)
end

function play(ins,note,oct)
	print("\asfi"..ins..note..oct)
end
-->8
function edit_state()
	// before start of game
	local s = {}

	function s.update() end

	function s.draw()
		print("‚¨ÜÔ∏è",13,104,7)
		print("‚¨ÖÔ∏è‚¨áÔ∏è‚û°Ô∏è",5,110,7)
		print("to move",3,116,7)
		print("üÖæÔ∏è to place note",38,104,7)
		print("‚ùé to play",38,111,7)
		draw_pointer()
	end

	function s.o()
		local cell = get_cell(px,py)
		if cell.spr == pn then
			cell.spr = -1
		else
			cell.spr = pn
			play(0,notes[py],1)
		end
	end

	function s.x()
		t = tempo
		state = play_state()
	end

	return s
end

function play_state()
	local s = {}
	
	function s.update()
		if t % tempo == 0 then
		cell_do_lane(t\tempo,false,
			function(x,y)
				local n = get_cell(x,y).spr
				if n >= 0 then
					play(0,notes[y],1)
				end
			end
			)
		end
		
		t+=1
		
		if t == (m+1) * tempo then
			state = edit_state()
		end
	end
	
	function s.draw()
		print("‚ùé to stop",38,111,7)
		local offset = ((t\tempo)-1)*7
		rect(2+offset,7,9+offset,98,9)
	end

	function s.o() end

	function s.x()
		state = edit_state()
	end
	
	return s
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00055000000550000005500000055000000550000005500000055000000550000000000000000000000000000000000000000000000000000000000000000000
0058850000599500005aa500005bb500005cc500005dd500005ee500005ff5000000000000000000000000000000000000000000000000000000000000000000
0058850000599500005aa500005bb500005cc500005dd500005ee500005ff5000000000000000000000000000000000000000000000000000000000000000000
00055000000550000005500000055000000550000005500000055000000550000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11555555599999999555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555551111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11555555595555559555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555551111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11555555595555559555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555551111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11555555595555559555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555551111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11555555595555559555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555551111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665665566566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665658856566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665658856566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665665566566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11555555595555559555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555551111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669665566566666656655665666666566666656666665666666566666656655665666666566666656655665666666566666651111111111110
11566666696666669658856566666656588565666666566666656666665666666566666656588565666666566666656588565666666566666651111111111110
11566666696666669658856566666656588565666666566666656666665666666566666656588565666666566666656588565666666566666651111111111110
11566666696666669665566566666656655665666666566666656666665666666566666656655665666666566666656655665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11555555595555559555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555551111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11555555595555559555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555551111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566556696655669666666566666656666665666666566556656666665665566566556656666665666666566666656666665665566566666651111111111110
11565885696588569666666566666656666665666666565885656666665658856565885656666665666666566666656666665658856566666651111111111110
11565885696588569666666566666656666665666666565885656666665658856565885656666665666666566666656666665658856566666651111111111110
11566556696655669666666566666656666665666666566556656666665665566566556656666665666666566666656666665665566566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11555555595555559555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555551111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11555555595555559555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555551111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11555555595555559555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555551111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656655665666666566666656666665666666566666656666665666666566556651111111111110
11566666696666669666666566666656666665666666566666656588565666666566666656666665666666566666656666665666666565885651111111111110
11566666696666669666666566666656666665666666566666656588565666666566666656666665666666566666656666665666666565885651111111111110
11566666696666669666666566666656666665666666566666656655665666666566666656666665666666566666656666665666666566556651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11555555595555559555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555551111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11555555595555559555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555551111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11566666696666669666666566666656666665666666566666656666665666666566666656666665666666566666656666665666666566666651111111111110
11555555599999999555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555551111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111177777111111777117711111177177711771777111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111771717711111171171711111711117117171717111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111777177711111171171711111777117117171777111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111771717711111171171711111117117117171711111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111177777111111171177111111771117117711711111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110

__sfx__
011200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011200000010000100001000010000100001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011200000020000200002000020000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011200000030000300003000030000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011200000040000400004000040000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011200000050000500005000050000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011200000060000600006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
011200000070000700007000070000700007000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
