pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
#include shared/state.p8
#include shared/grid.p8:1

function _init()
	cls()
	player=player_state()
end

function _update()
	player.controls()
	player.update()
end

function _draw()
	player.draw()
end
-->8
function player_state()
	local s = template_state()
	s.px=64
	s.py=64
	s.dx=0
	s.dy=0
	s.spd=2
	s.spr=64
	s.frames={}
	s.animate=false
	
	local function move(dx,dy)
		s.dx+=dx
		s.dy+=dy
	end
	
	s.set_btn(â¬…ï¸,move,{-1,0})
	s.set_btn(âž¡ï¸,move,{1,0})
	s.set_btn(â¬†ï¸,move,{0,-1})
	s.set_btn(â¬‡ï¸,move,{0,1})
	
	local function add_frames(f,n)
		for i=1,n do
			add(s.frames,f)
		end
	end
	
	local function attack()
		if #s.frames==0 then
			if s.dx !=0 or s.dy !=0 then
				add_frames(70,5)
				add_frames(72,5)
				sfx(0)
			else
				add_frames(74,5)
				add_frames(76,5)
				sfx(0)
			end
		end
	end
	
	s.set_btn(ðŸ…¾ï¸,attack)
	
	function s.update()
		// normalize movement
		local dx=s.dx*s.spd
		local dy=s.dy*s.spd
		if in_range(0,125,s.px+dx) then
			s.px+=dx
		end
		if in_range(0,125,s.py+dy) then
			s.py+=dy
		end
		
		// update sprite
		if #s.frames > 0 then
			s.spr=deli(s.frames,1)
		else
			if s.dx != 0 or s.dy !=0 then
				s.spr=66+(2*tonum(s.dx < 0))
			else
				s.spr=64
			end
		end
		s.dx=0
		s.dy=0
	end
	
	function s.draw()
		cls()
		spr(s.spr,s.px-6,s.py-15,2,4)
		spr(1,s.px,s.py)
	end
	
	return s
end

function create_attack(frames,
__gfx__
00000000077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000071c700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007007b1700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000055550000000000005555000000000000555500000000000055550000000000005555000000dddd00555500000000000055550000000000000000000000
0000557777750000000055777775000000005577777500000000557777750000000055777775000000ddddd77775000000005577777500000000000000000000
00557777777750000055777777775000005577777777500000557777777750000055777777775000005dddddd777500000557777777750000000000000000000
05577777777775000557777777777500055777777777750005577777777775000557777777777500055777ddddd7750005577777777775000000000000000000
057777777777775005777777777777500577777777777750057777777747775005777777774777500577777ddd44775005777777777777500000000000000000
557777777777775055777777777777505577777777777750557777777dd477505577777777d47750557777777744475055777777777777500000000000000000
05577777777775000557777777777500055777777777750005577777dd7445000557777777d44500055777777676450005577777777775000000000000000000
055777777777500005577777777750000557777777775000055777dd777740000557777777d74000055777776676500005577777777750000000000000000000
00557777755500000055777775550000005577777555000000557dd775554000005577777d554000005577776566000000557777755500000000000000000000
000555555500000000055555550000000005555555000000000ddd5555004000000555555d004000000555566560000000055555550007000000000000000000
00000666660000000000066666000000000000666600000000dd006660004400000000666d004400000000066660000000000066660707000000000000000000
000006066600000000066606666000660000066666000000ddd6666666666900666666666d666400000000066000000000000666666707000000000000000000
000066066060000000660006606606600000060666600000dddaaaaaaaaaa9900000000660d00400000000066000000000000606660707000000000000000000
00006006606000000660000660066600000066066060000000dddd06600049000000000660d04400000000066000000000006606667707000000000000000000
00006006600600000660000660006600000060066066066000000ddd600040000000000660d04000000000066000000000066006607007000000000000000000
0000600660066000006600066000000000066006600666000000000dd00440000000000660d44000000000066000000000460666677077000000000000000000
00066006600660000000000660000000000600066000600000000006dd0400000000000660d40000000000066000000000446606670070000000000000000000
0006000660006000000000066000000000066006600000000000000660d400000000000660d4000000000006600000000044d006600070000000000000000000
0000000660000000000000066000000000006606600000000000000660400000000000066040000000000006600000000000ddddd00000000000000000000000
00000006600000000000000660000000000000066000000000000006604000000000000660400000000000066000000000000dddddd000000000000000000000
0000000660000000000000066000000000000006600000000000000660000000000000066000000000000006600000000000000dddddd0000000000000000000
00000006600000000000000660000000000000066000000000000006600000000000000660000000000000066000000000000006600dd0000000000000000000
00000006600000000000000660000000000000066000000000000006600000000000000660000000000000066000000000000006600000000000000000000000
00000006600000000000000666000000000000066600000000000006660000000000000666000000000000066600000000000006660000000000000000000000
00000006600000000000000606000000000000060660000000000006060000000000000606000000000000060600000000000006060000000000000000000000
00000066660000000000006606600000000000060066600000000066066000000000006606600000000000660660000000000066066000000000000000000000
00000060066000000000066000600000000000060000660000000660006000000000066000600000000006600060000000000660006000000000000000000000
00000060006000000000660000660000000000060000066000006600006600000000660000660000000066000066000000006600006600000000000000000000
00000660006600000000600000066000000000066000000000006000000660000000600000066000000060000006600000006000000660000000000000000000
00000600000600000000000000006000000000006600000000000000000060000000000000006000000000000000600000000000000060000000000000000000
__sfx__
000100000762007620076200762007620076200762007620076200762007620076200661005610046100361002610026100261002610026100260002600036000260002600026000260001600006000060005600
00010000160501705017050190501b0501c0501d0501e0501f0501f05000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
002000001885000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
